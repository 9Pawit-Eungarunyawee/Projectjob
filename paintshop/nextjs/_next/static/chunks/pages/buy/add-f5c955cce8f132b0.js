(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7131],{76475:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/buy/add",function(){return n(46982)}])},90231:function(e,t,n){"use strict";n.d(t,{Gh:function(){return a},ZP:function(){return i},oF:function(){return o}});var r=n(11802),s=n(36100);n(53233);let l=(0,s.ad)(r.Z);async function i(e,t){let n=null,r=null;try{let r={name:t.name,createAt:s.EK.fromDate(new Date(t.createAt)),products:t.products,discount:""!==t.discount?t.discount:0,shippingCost:""!==t.shippingCost?t.shippingCost:0,user_id:t.user_id,totalCost:t.totalCost,status:"สำเร็จ"};n=await (0,s.ET)((0,s.hJ)(l,e),r),console.log("สร้างรายการซื้อสำเร็จ",n)}catch(e){console.error("เกิดข้อผิดพลาดในการสร้างรายการซื้อ:",r=e)}return{result:n,error:r}}async function a(e,t,n){let r=null,i=null;try{let i={name:n.name,createAt:s.EK.fromDate(new Date(n.createAt)),products:n.products,discount:""!==n.discount?n.discount:0,shippingCost:""!==n.shippingCost?n.shippingCost:0,user_id:n.user_id,totalCost:n.totalCost,status:"สำเร็จ"};r=await (0,s.pl)((0,s.JU)(l,e,t),i,{merge:!0}),console.log("แก้ไขข้อมูลเอกสารสำเร็จ:",r)}catch(e){console.error("เกิดข้อผิดพลาดในการแก้ไขข้อมูลเอกสาร:",i=e)}return{result:r,error:i}}async function o(e,t){let n=null,r=null;try{n=await (0,s.pl)((0,s.JU)(l,e,t),{status:"ยกเลิก"},{merge:!0}),console.log("ยกเลิกรายการสำเร็จ",n)}catch(e){console.error("เกิดข้อผิดพลาดในการยกเลิกรายการข้อมูล:",r=e)}return{result:n,error:r}}},53233:function(e,t,n){"use strict";n.d(t,{Z:function(){return i}});var r=n(11802),s=n(36100);let l=(0,s.ad)(r.Z);async function i(e,t,n){let r=null,i=null;if(n.catalog_id){let e=(0,s.JU)(l,"catalog",n.catalog_id);n.catalog_id=e}try{r=await (0,s.pl)((0,s.JU)(l,e,t),n,{merge:!0}),console.log("แก้ไขสำเร็จ",r)}catch(e){console.error("เกิดข้อผิดพลาดในการแก้ไขข้อมูล:",i=e)}return{result:r,error:i}}},46982:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return C}});var r=n(85893),s=n(9913),l=n(68239),i=n(46901),a=n(22430),o=n(58703),c=n(15861),d=n(83321),u=n(86886),p=n(98271),x=n(87357),h=n(87109),m=n(93946),g=n(96471),j=n(42761),Z=n(67294),f=n(76554),b=n(99061),_=n(50838),v=n(90231);function C(){let[e,t]=(0,Z.useState)(null),n=(0,l.Z)({palette:{primary:{main:"#018294"},success:{main:"#A9C470"},error:{main:"#FE616A"}}}),C=()=>{window.history.back()},{user:z}=(0,_.Eu)(),{productData:w}=(0,Z.useContext)(b.H),[y,S]=(0,Z.useState)(""),[P,E]=(0,Z.useState)(""),[k,W]=(0,Z.useState)(0),[N,A]=(0,Z.useState)(0),[D,I]=(0,Z.useState)([{product_name:"",product_id:"",product_exp:"",product_size:[{amount:"",size:"",cost:""}]}]),F=(e,t,n)=>{let r=[...D];r[t][n]=e.target.value,I(r)},R=(e,t,n,r)=>{let s=[...D];s[t].product_size[n][r]=e.target.value,I(s)},[q,J]=(0,Z.useState)(!1),T=(e,t)=>{"clickaway"!==t&&J(!1)},U=e=>{if(D.length>1){let t=[...D];t.splice(e,1),I(t)}else D.length<=1&&(t((0,r.jsx)(i.Z,{severity:"error",onClose:T,children:"ต้องมีสินค้าอย่างน้อย 1 อย่าง"})),J(!0))},$=(e,n)=>{if(D[e].product_size.length>1){let t={...D[e]},r=t.product_size.filter((e,t)=>t!==n);t.product_size=r;let s=[...D];s[e]=t,I(s)}else D[e].product_size.length<=1&&(t((0,r.jsx)(i.Z,{severity:"error",onClose:T,children:"ต้องมีรูปแบบสินค้าอย่างน้อย 1 รูปแบบ"})),J(!0))},[O,H]=(0,Z.useState)(!1),K=e=>{H(!0)},X=()=>{H(!1)},[G,L]=(0,Z.useState)(0);(0,Z.useEffect)(()=>{let e=0;D.forEach(t=>{t.product_size.forEach(t=>{let n=parseFloat(t.amount),r=parseFloat(t.cost);n&&r&&(e+=n*r)})}),k&&(e-=parseFloat(k)),N&&(e+=parseFloat(N)),L(e)},[D,k,N]);let B=async e=>{e.preventDefault();let n={name:y,createAt:P,products:D,discount:k,shippingCost:N,user_id:z.uid,totalCost:G},s=await (0,v.ZP)("buy",n);s?(t((0,r.jsx)(i.Z,{severity:"success",onClose:T,children:"เพิ่มข้อมูลสำเร็จ"})),J(!0),setTimeout(()=>{C()},500)):(t((0,r.jsx)(i.Z,{severity:"error",onClose:T,children:"ผิดพลาด! ไม่สามารถเพิ่มข้อมูลได้"})),J(!0))};return(0,r.jsx)(s.Z,{children:(0,r.jsxs)(a.Z,{theme:n,children:[(0,r.jsx)(o.Z,{open:q,autoHideDuration:6e3,onClose:T,children:e}),(0,r.jsx)(c.Z,{sx:{fontSize:"2rem",fontWeight:"600",mt:4},children:"สร้างรายการซื้อ"}),(0,r.jsxs)(d.Z,{sx:{color:"#018294",bgcolor:"white",fontWeight:"bold",borderRadius:"50px",boxShadow:"4px 4px 4px 0px rgba(0, 0, 0, 0.25)"},onClick:C,children:[(0,r.jsx)(g.Z,{}),(0,r.jsx)(c.Z,{children:" ย้อนกลับ"})]}),(0,r.jsx)(u.ZP,{container:!0,spacing:0,sx:{mt:3,mb:5,backgroundColor:"#fff",p:2,borderRadius:"10px",boxShadow:"4px 4px 4px 0px rgba(0, 0, 0, 0.25)"},children:(0,r.jsx)(u.ZP,{item:!0,xs:12,sm:7,children:(0,r.jsxs)("form",{onSubmit:B,className:"form",children:[(0,r.jsx)(c.Z,{sx:{mt:1},children:"ข้อมูล:"}),(0,r.jsx)(p.Z,{value:y,onChange:e=>S(e.target.value),variant:"outlined",label:"ชื่อรายการ",fullWidth:!0,required:!0,size:"small",sx:{mt:1,mb:1}}),(0,r.jsx)(c.Z,{sx:{mt:1},children:"วันที่:"}),(0,r.jsx)(p.Z,{variant:"outlined",value:P,onChange:e=>E(e.target.value),fullWidth:!0,required:!0,size:"small",sx:{mt:1,mb:1},type:"date"}),(0,r.jsx)(c.Z,{sx:{mt:1},children:"สินค้า:"}),D.map((e,t)=>(0,r.jsxs)(x.Z,{sx:{borderRadius:"10px",mt:1,mb:3,p:2,boxShadow:"rgba(6, 24, 44, 0.4) 0px 0px 0px 2px, rgba(6, 24, 44, 0.65) 0px 4px 6px -1px, rgba(255, 255, 255, 0.08) 0px 1px 0px inset"},children:[(0,r.jsx)(f.default,{handleCloseDialog:X,opendialog:O,productData:w,index:t,setProducts:I}),(0,r.jsx)(p.Z,{variant:"outlined",label:"ชื่อสินค้า",id:"product-name",name:"product_name",disabled:!0,value:e.product_name,onChange:e=>F(e,t,"product_name"),fullWidth:!0,size:"small",sx:{mt:1,mb:1},InputProps:{endAdornment:(0,r.jsx)(h.Z,{position:"end",children:(0,r.jsx)(m.Z,{onClick:K,children:(0,r.jsx)(j.Z,{})})})},InputLabelProps:{shrink:!0}}),(0,r.jsx)(c.Z,{sx:{mt:1},children:"รูปแบบสินค้า:"}),e.product_size.map((e,n)=>(0,r.jsxs)(x.Z,{sx:{m:1,p:2,mb:2,borderRadius:"10px",boxShadow:"rgba(255, 255, 255, 0.2) 0px 0px 0px 1px inset, rgba(0, 0, 0, 0.9) 0px 0px 0px 1px"},children:[(0,r.jsxs)(c.Z,{sx:{mt:1},children:["รูปแบบที่ ",n+1," :"]}),(0,r.jsx)(p.Z,{value:e.size,onChange:e=>R(e,t,n,"size"),variant:"outlined",label:"ขนาดสินค้า",fullWidth:!0,required:!0,size:"small",sx:{mt:1,mb:1}}),(0,r.jsx)(p.Z,{value:e.cost,onChange:e=>{let r=e.target.value;(/^\d*$/.test(r)||""===r)&&(""===r||parseInt(r)>=0&&"0"!==r[0])&&R(e,t,n,"cost")},variant:"outlined",label:"ราคาต่อหน่วย",fullWidth:!0,required:!0,size:"small",sx:{mt:1,mb:1}}),(0,r.jsx)(p.Z,{variant:"outlined",value:e.amount,onChange:e=>{let r=e.target.value;(/^\d*$/.test(r)||""===r)&&(""===r||parseInt(r)>=0&&"0"!==r[0])&&R(e,t,n,"amount")},label:"จำนวน",fullWidth:!0,required:!0,size:"small",sx:{mt:1,mb:1}}),(0,r.jsx)(d.Z,{sx:{mt:1,mb:1},variant:"outlined",color:"error",fullWidth:!0,onClick:()=>$(t,n),children:"ลบรูปแบบสินค้า"})]},n)),(0,r.jsx)(d.Z,{sx:{mt:1,mb:1},variant:"contained",fullWidth:!0,color:"error",onClick:()=>U(t),children:"ลบสินค้า"})]},t)),(0,r.jsx)(d.Z,{sx:{mb:1},variant:"contained",fullWidth:!0,onClick:()=>{I([...D,{product_id:"",product_size:[{amount:"",size:"",cost:""}],product_exp:""}])},children:"เพิ่มสินค้า"}),(0,r.jsx)(c.Z,{sx:{mt:1},children:"ส่วนลด :"}),(0,r.jsx)(p.Z,{variant:"outlined",value:k,onChange:e=>{let t=e.target.value;(/^\d*$/.test(t)||""===t)&&(""===t||parseInt(t)>=-1)&&W(e.target.value)},label:"ส่วนลด",fullWidth:!0,size:"small",sx:{mt:1,mb:1}}),(0,r.jsx)(c.Z,{sx:{mt:1},children:"ค่าส่ง :"}),(0,r.jsx)(p.Z,{variant:"outlined",value:N,onChange:e=>{let t=e.target.value;(/^\d*$/.test(t)||""===t)&&(""===t||parseInt(t)>=0&&"0"!==t[0])&&A(e.target.value)},label:"ค่าส่ง",fullWidth:!0,size:"small",sx:{mt:1,mb:1}}),(0,r.jsx)(x.Z,{sx:{p:3,bgcolor:"#EAE4E7",mt:1},children:(0,r.jsxs)(c.Z,{sx:{mt:1,fontSize:"1.3rem"},children:["มูลค่ารวมสุทธิ : ",isNaN(G)?"":G]})}),(0,r.jsx)(d.Z,{sx:{mb:1,mt:2},variant:"contained",color:"success",type:"submit",children:"สร้างรายการซื้อ"})]})})})]})})}n(36100)},76554:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return z}});var r=n(85893),s=n(11463),l=n(68239),i=n(90948),a=n(98102),o=n(89755),c=n(53816),d=n(50657),u=n(37645),p=n(6514),x=n(72882),h=n(90629),m=n(7906),g=n(53184),j=n(295),Z=n(83321),f=n(24661),b=n(27110),_=n(25675),v=n.n(_),C=n(67294);function z(e){let{handleCloseDialog:t,opendialog:n,productData:_,index:z,setProducts:w}=e,y=(0,l.Z)({palette:{primary:{main:"#018294"},success:{main:"#A9C470"},error:{main:"#FE616A"}}}),S=_.map((e,t)=>{var n,r,s;return n=e.id,r=e.img,s=e.name,{No:t+1,id:n,img:r,p_name:s,p_sell:e.p_sell,p_left:e.p_left,productSizes:e.productSizes}}),P=(0,i.ZP)(a.Z)(e=>{let{theme:t}=e;return{["&.".concat(o.Z.head)]:{backgroundColor:"#018294",color:t.palette.common.white},["&.".concat(o.Z.body)]:{fontSize:14}}}),E=(0,i.ZP)(c.Z)(e=>{let{theme:t}=e;return{"&:nth-of-type(odd)":{backgroundColor:t.palette.action.hover},"&:last-child td, &:last-child th":{border:0,padding:0}}}),[k,W]=(0,C.useState)(0),[N,A]=(0,C.useState)(5),D=e=>{console.log(e),w(t=>{let n=[...t];return n[z]={...n[z],product_name:e.p_name,product_id:e.id,product_size:e.productSizes.map(e=>({amount:"",size:e.size,cost:e.cost}))},n}),t()};return(0,r.jsx)(s.a,{theme:y,children:(0,r.jsxs)(d.Z,{open:n,onClose:t,maxWidth:"md",fullWidth:!0,children:[(0,r.jsx)(u.Z,{children:"ค้นหาสินค้า"}),(0,r.jsx)(p.Z,{children:(0,r.jsx)(x.Z,{component:h.Z,sx:{borderRadius:"25px",mb:5},children:(0,r.jsxs)(m.Z,{sx:{minWidth:700},children:[(0,r.jsx)(g.Z,{children:(0,r.jsxs)(c.Z,{children:[(0,r.jsx)(P,{align:"center",children:"No."}),(0,r.jsx)(P,{align:"center",children:"รูปภาพ"}),(0,r.jsx)(P,{align:"center",children:"ชื่อสินค้า"}),(0,r.jsx)(P,{align:"center",children:"ขาย"}),(0,r.jsx)(P,{align:"center",children:"เหลือ"}),(0,r.jsx)(P,{align:"center",children:"ราคาซื้อ"}),(0,r.jsx)(P,{align:"center"})]})}),(0,r.jsx)(j.Z,{children:(N>0?S.slice(k*N,k*N+N):S).map(e=>(0,r.jsxs)(E,{children:[(0,r.jsx)(P,{component:"th",scope:"row",align:"center",children:e.No}),(0,r.jsx)(P,{align:"center",children:(0,r.jsx)(v(),{src:e.img,alt:"Product Image",priority:!0,height:"60",width:"60"})}),(0,r.jsx)(P,{align:"center",children:e.p_name}),(0,r.jsx)(P,{align:"center",children:e.p_sell}),(0,r.jsx)(P,{align:"center",children:e.p_left}),(0,r.jsx)(P,{align:"center",children:e.productSizes[0].price}),(0,r.jsx)(P,{align:"center",children:(0,r.jsx)(Z.Z,{variant:"outlined",onClick:()=>D(e),children:"เลือก"})})]},e.No))}),(0,r.jsx)(f.Z,{children:(0,r.jsx)(c.Z,{children:(0,r.jsx)(b.Z,{rowsPerPageOptions:[2,5,10,25,{label:"ทั้งหมด",value:-1}],count:S.length,rowsPerPage:N,page:k,labelRowsPerPage:"รายการสินค้าต่อหน้า",onPageChange:(e,t)=>{W(t)},onRowsPerPageChange:e=>{A(parseInt(e.target.value,10)),W(0)}})})})]})})})]})})}}},function(e){e.O(0,[2607,7609,5675,6298,6185,1283,3717,3914,8360,8271,4163,4792,9254,1990,6556,9913,9774,2888,179],function(){return e(e.s=76475)}),_N_E=e.O()}]);