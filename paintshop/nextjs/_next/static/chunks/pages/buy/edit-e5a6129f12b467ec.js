(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4913],{96471:function(e,t,n){"use strict";var s=n(64836);t.Z=void 0;var r=s(n(64938)),a=n(85893),i=(0,r.default)((0,a.jsx)("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"}),"ArrowBackOutlined");t.Z=i},42761:function(e,t,n){"use strict";var s=n(64836);t.Z=void 0;var r=s(n(64938)),a=n(85893),i=(0,r.default)((0,a.jsx)("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"}),"Search");t.Z=i},87109:function(e,t,n){"use strict";n.d(t,{Z:function(){return y}});var s,r=n(63366),a=n(87462),i=n(67294),o=n(86010),l=n(94780),u=n(98216),d=n(15861),c=n(47167),p=n(74423),x=n(90948),m=n(1588),h=n(34867);function f(e){return(0,h.Z)("MuiInputAdornment",e)}let v=(0,m.Z)("MuiInputAdornment",["root","filled","standard","outlined","positionStart","positionEnd","disablePointerEvents","hiddenLabel","sizeSmall"]);var g=n(71657),Z=n(85893);let b=["children","className","component","disablePointerEvents","disableTypography","position","variant"],j=e=>{let{classes:t,disablePointerEvents:n,hiddenLabel:s,position:r,size:a,variant:i}=e,o={root:["root",n&&"disablePointerEvents",r&&`position${(0,u.Z)(r)}`,i,s&&"hiddenLabel",a&&`size${(0,u.Z)(a)}`]};return(0,l.Z)(o,f,t)},C=(0,x.ZP)("div",{name:"MuiInputAdornment",slot:"Root",overridesResolver:(e,t)=>{let{ownerState:n}=e;return[t.root,t[`position${(0,u.Z)(n.position)}`],!0===n.disablePointerEvents&&t.disablePointerEvents,t[n.variant]]}})(({theme:e,ownerState:t})=>(0,a.Z)({display:"flex",height:"0.01em",maxHeight:"2em",alignItems:"center",whiteSpace:"nowrap",color:(e.vars||e).palette.action.active},"filled"===t.variant&&{[`&.${v.positionStart}&:not(.${v.hiddenLabel})`]:{marginTop:16}},"start"===t.position&&{marginRight:8},"end"===t.position&&{marginLeft:8},!0===t.disablePointerEvents&&{pointerEvents:"none"})),_=i.forwardRef(function(e,t){let n=(0,g.Z)({props:e,name:"MuiInputAdornment"}),{children:l,className:u,component:x="div",disablePointerEvents:m=!1,disableTypography:h=!1,position:f,variant:v}=n,_=(0,r.Z)(n,b),y=(0,p.Z)()||{},z=v;v&&y.variant,y&&!z&&(z=y.variant);let w=(0,a.Z)({},n,{hiddenLabel:y.hiddenLabel,size:y.size,disablePointerEvents:m,position:f,variant:z}),E=j(w);return(0,Z.jsx)(c.Z.Provider,{value:null,children:(0,Z.jsx)(C,(0,a.Z)({as:x,ownerState:w,className:(0,o.Z)(E.root,u),ref:t},_,{children:"string"!=typeof l||h?(0,Z.jsxs)(i.Fragment,{children:["start"===f?s||(s=(0,Z.jsx)("span",{className:"notranslate",children:"​"})):null,l]}):(0,Z.jsx)(d.Z,{color:"text.secondary",children:l})}))})});var y=_},72043:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/buy/edit",function(){return n(31233)}])},90231:function(e,t,n){"use strict";n.d(t,{Gh:function(){return o},ZP:function(){return i},oF:function(){return l}});var s=n(11802),r=n(36100);n(53233);let a=(0,r.ad)(s.Z);async function i(e,t){let n=null,s=null;try{let s={name:t.name,createAt:r.EK.fromDate(new Date(t.createAt)),products:t.products,discount:""!==t.discount?t.discount:0,shippingCost:""!==t.shippingCost?t.shippingCost:0,user_id:t.user_id,totalCost:t.totalCost,status:"สำเร็จ"};n=await (0,r.ET)((0,r.hJ)(a,e),s),console.log("สร้างรายการซื้อสำเร็จ",n)}catch(e){console.error("เกิดข้อผิดพลาดในการสร้างรายการซื้อ:",s=e)}return{result:n,error:s}}async function o(e,t,n){let s=null,i=null;try{let i={name:n.name,createAt:r.EK.fromDate(new Date(n.createAt)),products:n.products,discount:""!==n.discount?n.discount:0,shippingCost:""!==n.shippingCost?n.shippingCost:0,user_id:n.user_id,totalCost:n.totalCost,status:"สำเร็จ"};s=await (0,r.pl)((0,r.JU)(a,e,t),i,{merge:!0}),console.log("แก้ไขข้อมูลเอกสารสำเร็จ:",s)}catch(e){console.error("เกิดข้อผิดพลาดในการแก้ไขข้อมูลเอกสาร:",i=e)}return{result:s,error:i}}async function l(e,t){let n=null,s=null;try{n=await (0,r.pl)((0,r.JU)(a,e,t),{status:"ยกเลิก"},{merge:!0}),console.log("ยกเลิกรายการสำเร็จ",n)}catch(e){console.error("เกิดข้อผิดพลาดในการยกเลิกรายการข้อมูล:",s=e)}return{result:n,error:s}}},53233:function(e,t,n){"use strict";n.d(t,{Z:function(){return i}});var s=n(11802),r=n(36100);let a=(0,r.ad)(s.Z);async function i(e,t,n){let s=null,i=null;if(n.catalog_id){let e=(0,r.JU)(a,"catalog",n.catalog_id);n.catalog_id=e}try{s=await (0,r.pl)((0,r.JU)(a,e,t),n,{merge:!0}),console.log("แก้ไขสำเร็จ",s)}catch(e){console.error("เกิดข้อผิดพลาดในการแก้ไขข้อมูล:",i=e)}return{result:s,error:i}}},31233:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return w}});var s=n(85893),r=n(9913),a=n(68239),i=n(46901),o=n(22430),l=n(58703),u=n(15861),d=n(83321),c=n(86886),p=n(98271),x=n(87357),m=n(87109),h=n(93946),f=n(96471),v=n(42761),g=n(67294),Z=n(55091),b=n(99061),j=n(50838),C=n(90231);n(36100);var _=n(49925),y=n(11163),z=n(42298);function w(){let[e,t]=(0,g.useState)(null),n=(0,a.Z)({palette:{primary:{main:"#018294"},success:{main:"#A9C470"},error:{main:"#FE616A"}}}),w=()=>{window.history.back()},{user:E}=(0,j.Eu)(),{productData:S}=(0,g.useContext)(b.H),[P,A]=(0,g.useState)(""),[k,W]=(0,g.useState)(""),[N,I]=(0,g.useState)(0),[L,D]=(0,g.useState)(0),[R,$]=(0,g.useState)([{product_name:"",product_id:"",product_exp:"",product_size:[{amount:"",size:"",cost:""}]}]),M=(0,y.useRouter)(),F=JSON.parse(M.query.id);(0,g.useEffect)(()=>{q()},[]);let q=async()=>{let{result:e,error:t}=await (0,_.ZP)("buy",F);if(t)console.error("Error fetching document:",t);else if(e){let t=e.data(),n=t.products.map(e=>({...e}));$(n),W((0,z.default)(t.createAt.toDate(),"yyyy-MM-dd")),A(t.name),I(t.discount),D(t.shippingCost)}},J=(e,t,n)=>{let s=[...R];s[t][n]=e.target.value,$(s)},T=(e,t,n,s)=>{let r=[...R];r[t].product_size[n][s]=e.target.value,$(r)},[H,O]=(0,g.useState)(!1),U=(e,t)=>{"clickaway"!==t&&O(!1)},G=e=>{if(R.length>1){let t=[...R];t.splice(e,1),$(t)}else R.length<=1&&(t((0,s.jsx)(i.Z,{severity:"error",onClose:U,children:"ต้องมีสินค้าอย่างน้อย 1 อย่าง"})),O(!0))},K=(e,n)=>{if(R[e].product_size.length>1){let t={...R[e]},s=t.product_size.filter((e,t)=>t!==n);t.product_size=s;let r=[...R];r[e]=t,$(r)}else R[e].product_size.length<=1&&(t((0,s.jsx)(i.Z,{severity:"error",onClose:U,children:"ต้องมีรูปแบบสินค้าอย่างน้อย 1 รูปแบบ"})),O(!0))},[X,B]=(0,g.useState)(!1),Q=e=>{B(!0)},V=()=>{B(!1)},[Y,ee]=(0,g.useState)(0);(0,g.useEffect)(()=>{let e=0;R.forEach(t=>{t.product_size.forEach(t=>{let n=parseFloat(t.amount),s=parseFloat(t.cost);n&&s&&(e+=n*s)})}),N&&(e-=parseFloat(N)),L&&(e+=parseFloat(L)),ee(e)},[R,N,L]);let et=async e=>{e.preventDefault();let n={name:P,createAt:k,products:R,discount:N,shippingCost:L,user_id:E.uid,totalCost:Y},r=await (0,C.Gh)("buy",F,n);r?(t((0,s.jsx)(i.Z,{severity:"success",onClose:U,children:"แก้ไขข้อมูลสำเร็จ"})),O(!0),setTimeout(()=>{w()},500)):(t((0,s.jsx)(i.Z,{severity:"error",onClose:U,children:"ผิดพลาด! ไม่สามารถแก้ไขข้อมูลได้"})),O(!0))};return(0,s.jsx)(r.Z,{children:(0,s.jsxs)(o.Z,{theme:n,children:[(0,s.jsx)(l.Z,{open:H,autoHideDuration:6e3,onClose:U,children:e}),(0,s.jsx)(u.Z,{sx:{fontSize:"2rem",fontWeight:"600",mt:4},children:"แก้ไขรายการซื้อ"}),(0,s.jsxs)(d.Z,{sx:{color:"#018294",bgcolor:"white",fontWeight:"bold",borderRadius:"50px",boxShadow:"4px 4px 4px 0px rgba(0, 0, 0, 0.25)"},onClick:w,children:[(0,s.jsx)(f.Z,{}),(0,s.jsx)(u.Z,{children:" ย้อนกลับ"})]}),(0,s.jsx)(c.ZP,{container:!0,spacing:0,sx:{mt:3,mb:5,backgroundColor:"#fff",p:2,borderRadius:"10px",boxShadow:"4px 4px 4px 0px rgba(0, 0, 0, 0.25)"},children:(0,s.jsx)(c.ZP,{item:!0,xs:12,sm:7,children:(0,s.jsxs)("form",{onSubmit:et,className:"form",children:[(0,s.jsx)(u.Z,{sx:{mt:1},children:"ข้อมูล:"}),(0,s.jsx)(p.Z,{value:P,onChange:e=>A(e.target.value),variant:"outlined",label:"ชื่อรายการ",fullWidth:!0,required:!0,size:"small",sx:{mt:1,mb:1}}),(0,s.jsx)(u.Z,{sx:{mt:1},children:"วันที่:"}),(0,s.jsx)(p.Z,{variant:"outlined",value:k,onChange:e=>W(e.target.value),fullWidth:!0,required:!0,size:"small",sx:{mt:1,mb:1},type:"date"}),(0,s.jsx)(u.Z,{sx:{mt:1},children:"สินค้า:"}),R.map((e,t)=>(0,s.jsxs)(x.Z,{sx:{borderRadius:"10px",mt:1,mb:3,p:2,boxShadow:"rgba(6, 24, 44, 0.4) 0px 0px 0px 2px, rgba(6, 24, 44, 0.65) 0px 4px 6px -1px, rgba(255, 255, 255, 0.08) 0px 1px 0px inset"},children:[(0,s.jsx)(Z.default,{handleCloseDialog:V,opendialog:X,productData:S,index:t,setProducts:$}),(0,s.jsx)(p.Z,{variant:"outlined",label:"ชื่อสินค้า",id:"product-name",name:"product_name",disabled:!0,value:e.product_name,onChange:e=>J(e,t,"product_name"),fullWidth:!0,size:"small",sx:{mt:1,mb:1},InputProps:{endAdornment:(0,s.jsx)(m.Z,{position:"end",children:(0,s.jsx)(h.Z,{onClick:Q,children:(0,s.jsx)(v.Z,{})})})},InputLabelProps:{shrink:!0}}),(0,s.jsx)(u.Z,{sx:{mt:1},children:"รูปแบบสินค้า:"}),e.product_size.map((e,n)=>(0,s.jsxs)(x.Z,{sx:{m:1,p:2,mb:2,borderRadius:"10px",boxShadow:"rgba(255, 255, 255, 0.2) 0px 0px 0px 1px inset, rgba(0, 0, 0, 0.9) 0px 0px 0px 1px"},children:[(0,s.jsxs)(u.Z,{sx:{mt:1},children:["รูปแบบที่ ",n+1," :"]}),(0,s.jsx)(p.Z,{value:e.size,onChange:e=>T(e,t,n,"size"),variant:"outlined",label:"ขนาดสินค้า",fullWidth:!0,required:!0,size:"small",sx:{mt:1,mb:1}}),(0,s.jsx)(p.Z,{value:e.cost,onChange:e=>{let s=e.target.value;(/^\d*$/.test(s)||""===s)&&(""===s||parseInt(s)>=0&&"0"!==s[0])&&T(e,t,n,"cost")},variant:"outlined",label:"ราคาต่อหน่วย",fullWidth:!0,required:!0,size:"small",sx:{mt:1,mb:1}}),(0,s.jsx)(p.Z,{variant:"outlined",value:e.amount,onChange:e=>{let s=e.target.value;(/^\d*$/.test(s)||""===s)&&(""===s||parseInt(s)>=0&&"0"!==s[0])&&T(e,t,n,"amount")},label:"จำนวน",fullWidth:!0,required:!0,size:"small",sx:{mt:1,mb:1}}),(0,s.jsx)(d.Z,{sx:{mt:1,mb:1},variant:"outlined",color:"error",fullWidth:!0,onClick:()=>K(t,n),children:"ลบรูปแบบสินค้า"})]},n)),(0,s.jsx)(d.Z,{sx:{mt:1,mb:1},variant:"contained",fullWidth:!0,color:"error",onClick:()=>G(t),children:"ลบสินค้า"})]},t)),(0,s.jsx)(d.Z,{sx:{mb:1},variant:"contained",fullWidth:!0,onClick:()=>{$([...R,{product_id:"",product_size:[{amount:"",size:"",cost:""}],product_exp:""}])},children:"เพิ่มสินค้า"}),(0,s.jsx)(u.Z,{sx:{mt:1},children:"ส่วนลด :"}),(0,s.jsx)(p.Z,{variant:"outlined",value:N,onChange:e=>{let t=e.target.value;(/^\d*$/.test(t)||""===t)&&(""===t||parseInt(t)>=-1)&&I(e.target.value)},label:"ส่วนลด",fullWidth:!0,size:"small",sx:{mt:1,mb:1}}),(0,s.jsx)(u.Z,{sx:{mt:1},children:"ค่าส่ง :"}),(0,s.jsx)(p.Z,{variant:"outlined",value:L,onChange:e=>{let t=e.target.value;(/^\d*$/.test(t)||""===t)&&(""===t||parseInt(t)>=0&&"0"!==t[0])&&D(e.target.value)},label:"ค่าส่ง",fullWidth:!0,size:"small",sx:{mt:1,mb:1}}),(0,s.jsx)(x.Z,{sx:{p:3,bgcolor:"#EAE4E7",mt:1},children:(0,s.jsxs)(u.Z,{sx:{mt:1,fontSize:"1.3rem"},children:["มูลค่ารวมสุทธิ : ",isNaN(Y)?"":Y]})}),(0,s.jsx)(d.Z,{sx:{mb:1,mt:2},variant:"contained",color:"success",type:"submit",children:"แก้ไขรายการซื้อ"})]})})})]})})}}},function(e){e.O(0,[2607,7609,5675,6298,6185,1283,3717,3914,8360,8271,4163,4792,9254,1990,9802,9913,7825,9774,2888,179],function(){return e(e.s=72043)}),_N_E=e.O()}]);