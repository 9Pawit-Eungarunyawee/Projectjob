"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4508],{34300:function(e,t,r){r.d(t,{RS:function(){return d},SR:function(){return c},ZP:function(){return s},cB:function(){return i}});var a=r(11802),l=r(36100),n=r(49925);let o=(0,l.ad)(a.Z);async function s(e,t){let r=null,a=null,n=(0,l.JU)(o,"catalog",t.catalog_id);try{let a=t.img?t.img:"",s={name:t.name,catalog_id:n,detail:t.detail,flim:t.flim,grade:t.grade,lot:t.lot,status:t.status,img:a,area:t.area,productSizes:t.productSizes,delete:null,create:{createAt:(0,l.Bt)(),createBy:t.user_id},update:null};r=await (0,l.ET)((0,l.hJ)(o,e),s),console.log("เพิ่มข้อมูลสำเร็จ",r)}catch(e){console.error("เกิดข้อผิดพลาดในการเพิ่มข้อมูล:",a=e)}return{result:r,error:a}}let c=async(e,t)=>{let r=null,a=null,n=(0,l.JU)(o,e,t);try{await (0,l.oe)(n),console.log("ลบข้อมูลสำเร็จ"),r="Success"}catch(e){console.error("เกิดข้อผิดพลาดในการลบข้อมูล:",a=e)}return{result:r,error:a}};async function d(e,t){let r=null,a=null;try{let a=await (0,n.ZP)("users",t.user_id);if(a.result&&a.result.exists){let n=a.result.data().name,s={delete:{deleteAt:(0,l.Bt)(),deleteBy:n}};r=await (0,l.pl)((0,l.JU)(o,e,t.id),s,{merge:!0}),console.log("Soft delete สำเร็จ",r)}else console.log("หาข้อมูล user ใน soft del ไม่เจอ")}catch(e){console.error("เกิดข้อผิดพลาดในการ soft delete:",a=e)}return{result:r,error:a}}async function i(e,t){let r=null,a=null;try{r=await (0,l.pl)((0,l.JU)(o,e,t),{delete:null},{merge:!0}),console.log("restoreData สำเร็จ",r)}catch(e){console.error("เกิดข้อผิดพลาดในการ restoreData:",a=e)}return{result:r,error:a}}},726:function(e,t,r){r.d(t,{Z:function(){return o}});var a=r(36100),l=r(11802);let n=(0,a.ad)(l.Z);async function o(e,t,r){try{let l=t.toLowerCase(),o=r.toLowerCase(),s=(0,a.IO)((0,a.hJ)(n,e),(0,a.Xo)(l)),c=await (0,a.PL)(s),d=c.docs.filter(e=>{let t=e.data()[l];return t&&-1!==t.toLowerCase().indexOf(o)}).map(e=>({id:e.id,...e.data()}));return d}catch(e){throw console.error("Error searching data:",e),e}}},34508:function(e,t,r){r.r(t),r.d(t,{default:function(){return B}});var a=r(85893),l=r(9913),n=r(87357),o=r(68239),s=r(46901),c=r(58703),d=r(22430),i=r(15861),u=r(98271),h=r(87109),f=r(83321),x=r(88409),p=r(40044),j=r(42761),m=r(39264),Z=r(11163),g=r(67294),E=r(34300),y=r(50838),b=r(23279),w=r.n(b),v=r(726),S=r(99061),_=r(45697),C=r.n(_),k=r(60533);r(49925);var D=r(54574);function z(e){let{children:t,value:r,index:l,...o}=e;return(0,a.jsx)("div",{role:"tabpanel",hidden:r!==l,id:"simple-tabpanel-".concat(l),"aria-labelledby":"simple-tab-".concat(l),...o,children:r===l&&(0,a.jsx)(n.Z,{sx:{pt:3},children:(0,a.jsx)(n.Z,{children:t})})})}function A(e){return{id:"simple-tab-".concat(e),"aria-controls":"simple-tabpanel-".concat(e)}}function B(){let e=(0,o.Z)({palette:{primary:{main:"#018294"},success:{main:"#A9C470"},error:{main:"#FE616A"}}}),{user:t}=(0,y.Eu)(),{productData:r,setProductData:b,fetchProductData:_}=(0,g.useContext)(S.H),{buyData:C}=(0,g.useContext)(k.h),{orderData:B}=(0,g.useContext)(D.y),[I,J]=(0,g.useState)(""),O=(0,Z.useRouter)(),P=w()(async e=>{try{let t=await (0,v.Z)("products","name",e),r=t.filter(e=>!e.delete);b(r)}catch(e){console.error("Error searching data:",e)}},500),R=e=>{J(e),P(e)};(0,g.useEffect)(()=>{_()},[]);let L=async e=>{let r={id:e,user_id:t.uid},l=await (0,E.RS)("products",r);R(""),l?(q((0,a.jsx)(s.Z,{severity:"success",onClose:N,children:"ลบข้อมูลสำเร็จ"})),M(!0)):(q((0,a.jsx)(s.Z,{severity:"error",onClose:N,children:"ผิดพลาด! ไม่สามารถลบข้อมูลได้"})),M(!0))},[U,q]=(0,g.useState)(null),[H,M]=(0,g.useState)(!1),N=(e,t)=>{"clickaway"!==t&&M(!1)},[T,F]=(0,g.useState)(0),[W,X]=(0,g.useState)([]),[G,K]=(0,g.useState)([]);(0,g.useEffect)(()=>{void 0!=r&&void 0!=C&&void 0!=B&&(console.log("getProductOutOfStock:",Q(r,C,B)),console.log("getProductAlmostOutOfStock:",V(r,C,B)),X(Q(r,C,B)),K(V(r,C,B)))},[r,C,B]);let Q=(e,t,r)=>{let a=new Set,l=new Set;t.forEach(e=>{e.products.forEach(e=>{a.add(e.product_id)})}),r.forEach(e=>{e.products.forEach(e=>{l.add(e.product_id)})});let n=new Map;t.forEach(e=>{e.products.forEach(e=>{e.product_size.forEach(t=>{let r=e.product_id,a=parseInt(t.amount);n.set(r,(n.get(r)||0)+a)})})}),r.forEach(e=>{e.products.forEach(e=>{let t=e.product_id,r=parseInt(e.amount);n.set(t,(n.get(t)||0)-r)})});let o=e.filter(e=>0>=(n.get(e.id)||0));return o},V=(e,t,r)=>{let a=new Set,l=new Set;t.forEach(e=>{e.products.forEach(e=>{a.add(e.product_id)})}),r.forEach(e=>{e.products.forEach(e=>{l.add(e.product_id)})});let n=new Map;t.forEach(e=>{e.products.forEach(e=>{e.product_size.forEach(t=>{let r=e.product_id,a=parseInt(t.amount);n.set(r,(n.get(r)||0)+a)})})}),r.forEach(e=>{e.products.forEach(e=>{let t=e.product_id,r=parseInt(e.amount);n.set(t,(n.get(t)||0)-r)})}),console.log("จำนวนสินค้าใน buyData:",n);let o=e.filter(e=>10>n.get(e.id)&&n.get(e.id)>0||0);return o};return(0,a.jsxs)(l.Z,{children:[(0,a.jsx)(c.Z,{open:H,autoHideDuration:6e3,onClose:N,children:U}),(0,a.jsx)(d.Z,{theme:e,children:(0,a.jsxs)(n.Z,{sx:{height:"100%",width:"100%",mt:5},children:[(0,a.jsx)(i.Z,{sx:{fontSize:"2rem",fontWeight:"600"},children:"การจัดการสินค้า"}),(0,a.jsx)(n.Z,{sx:{mt:1},children:(0,a.jsx)(u.Z,{label:"ค้นหา",variant:"outlined",size:"small",onChange:e=>R(e.target.value),InputProps:{startAdornment:(0,a.jsx)(h.Z,{position:"start",children:(0,a.jsx)(j.Z,{sx:{fontSize:"1.4rem"}})})}})}),(0,a.jsxs)(n.Z,{children:[(0,a.jsxs)(n.Z,{sx:{display:"flex",justifyContent:{xl:"flex-end"}},children:[(0,a.jsx)(f.Z,{variant:"contained",color:"success",sx:{mr:2,mb:2,mt:2},onClick:function(){O.push("/product/addproduct")},children:"เพิ่มสินค้า"}),(0,a.jsx)(f.Z,{variant:"contained",color:"error",sx:{mb:2,mt:2},onClick:()=>{O.push("product/history")},children:"ประวัติการลบ"})]}),(0,a.jsxs)(n.Z,{sx:{width:"100%"},children:[(0,a.jsx)(n.Z,{sx:{borderBottom:1,borderColor:"divider"},children:(0,a.jsxs)(x.Z,{value:T,onChange:(e,t)=>{F(t)},"aria-label":"basic tabs example",children:[(0,a.jsx)(p.Z,{label:(0,a.jsx)(i.Z,{children:"ทั้งหมด"}),...A(0)}),(0,a.jsx)(p.Z,{label:(0,a.jsx)(i.Z,{children:"พร้อมขาย"}),...A(1)}),(0,a.jsx)(p.Z,{label:(0,a.jsx)(i.Z,{children:"ไม่พร้อมขาย"}),...A(2)}),(0,a.jsx)(p.Z,{label:(0,a.jsx)(i.Z,{children:"สินค้าใกล้หมด"}),...A(3)}),(0,a.jsx)(p.Z,{label:(0,a.jsx)(i.Z,{children:"สินค้าหมด"}),...A(4)})]})}),(0,a.jsx)(z,{value:T,index:0,children:(0,a.jsx)(m.default,{data:{data:r},onDelete:L})}),(0,a.jsx)(z,{value:T,index:1,children:(0,a.jsx)(m.default,{data:{data:r.filter(e=>e.status)},onDelete:L})}),(0,a.jsx)(z,{value:T,index:2,children:(0,a.jsx)(m.default,{data:{data:r.filter(e=>!e.status)},onDelete:L})}),(0,a.jsx)(z,{value:T,index:3,children:(0,a.jsx)(m.default,{data:{data:G},onDelete:L})}),(0,a.jsx)(z,{value:T,index:4,children:(0,a.jsx)(m.default,{data:{data:W},onDelete:L})})]})]})]})})]})}z.propTypes={children:C().node,index:C().number.isRequired,value:C().number.isRequired}}}]);