"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4508],{34300:function(e,t,r){r.d(t,{RS:function(){return i},SR:function(){return c},ZP:function(){return s},cB:function(){return u}});var n=r(11802),l=r(36100),a=r(49925);let o=(0,l.ad)(n.Z);async function s(e,t){let r=null,n=null,a=(0,l.JU)(o,"catalog",t.catalog_id);try{let n=t.img?t.img:"",s={name:t.name,catalog_id:a,detail:t.detail,flim:t.flim,grade:t.grade,lot:t.lot,status:t.status,img:n,area:t.area,productSizes:t.productSizes,delete:null,create:{createAt:(0,l.Bt)(),createBy:t.user_id},update:null};r=await (0,l.ET)((0,l.hJ)(o,e),s),console.log("เพิ่มข้อมูลสำเร็จ",r)}catch(e){console.error("เกิดข้อผิดพลาดในการเพิ่มข้อมูล:",n=e)}return{result:r,error:n}}let c=async(e,t)=>{let r=null,n=null,a=(0,l.JU)(o,e,t);try{await (0,l.oe)(a),console.log("ลบข้อมูลสำเร็จ"),r="Success"}catch(e){console.error("เกิดข้อผิดพลาดในการลบข้อมูล:",n=e)}return{result:r,error:n}};async function i(e,t){let r=null,n=null;try{let n=await (0,a.ZP)("users",t.user_id);if(n.result&&n.result.exists){let a=n.result.data().name,s={delete:{deleteAt:(0,l.Bt)(),deleteBy:a}};r=await (0,l.pl)((0,l.JU)(o,e,t.id),s,{merge:!0}),console.log("Soft delete สำเร็จ",r)}else console.log("หาข้อมูล user ใน soft del ไม่เจอ")}catch(e){console.error("เกิดข้อผิดพลาดในการ soft delete:",n=e)}return{result:r,error:n}}async function u(e,t){let r=null,n=null;try{r=await (0,l.pl)((0,l.JU)(o,e,t),{delete:null},{merge:!0}),console.log("restoreData สำเร็จ",r)}catch(e){console.error("เกิดข้อผิดพลาดในการ restoreData:",n=e)}return{result:r,error:n}}},49925:function(e,t,r){r.d(t,{EC:function(){return c},Eq:function(){return u},KL:function(){return i},PR:function(){return d},ZP:function(){return o},_N:function(){return s},wv:function(){return h}});var n=r(11802),l=r(36100);let a=(0,l.ad)(n.Z);async function o(e,t){let r=(0,l.JU)(a,e,t);try{let e=await (0,l.QT)(r);return{result:e,error:null}}catch(e){return{result:null,error:e}}}let s=async e=>{let t=await (0,l.PL)((0,l.hJ)(a,e));return{result:t,error:null}},c=async(e,t)=>{let r=(0,l.JU)(a,"catalog",t),n=(0,l.IO)((0,l.hJ)(a,e),(0,l.ar)("catalog_id","==",r)),o=await (0,l.PL)(n);return{result:o,error:null}},i=async e=>{let t=[];for(let r of e){let e=await (0,l.QT)((0,l.JU)(a,"products",r));if(e.exists()){let n=e.data(),l={id:r,...n};t.push(l)}}return t},u=async e=>{let t=[];for(let r of e){let e=await (0,l.QT)((0,l.JU)(a,"colors",r));if(e.exists()){let n=e.data(),l={id:r,...n};t.push(l)}}return t},d=async(e,t)=>{let r=(0,l.IO)((0,l.hJ)(a,e),(0,l.ar)("uid","==",String(t))),n=await (0,l.PL)(r);return n.forEach(e=>{console.log(e.id," => ",e.data())}),{result:n,error:null}},h=async(e,t)=>{let r=(0,l.JU)(a,"catalog",t),n=await (0,l.QT)(r);if(!n.exists())return console.error("Catalog document not found"),{result:null,error:"Catalog document not found"};let o=(0,l.IO)((0,l.hJ)(a,e),(0,l.ar)("catalog_id","==",r));try{let e=await (0,l.PL)(o);return e.forEach(e=>{console.log(e.id," => ",e.data())}),{result:e,error:null}}catch(e){return console.error("Error getting products: ",e),{result:null,error:e}}}},726:function(e,t,r){r.d(t,{Z:function(){return o}});var n=r(36100),l=r(11802);let a=(0,n.ad)(l.Z);async function o(e,t,r){try{let l=t.toLowerCase(),o=r.toLowerCase(),s=(0,n.IO)((0,n.hJ)(a,e),(0,n.Xo)(l)),c=await (0,n.PL)(s),i=c.docs.filter(e=>{let t=e.data()[l];return t&&-1!==t.toLowerCase().indexOf(o)}).map(e=>({id:e.id,...e.data()}));return i}catch(e){throw console.error("Error searching data:",e),e}}},34508:function(e,t,r){r.r(t),r.d(t,{default:function(){return _}});var n=r(85893),l=r(98010),a=r(68239),o=r(46901),s=r(58703),c=r(22430),i=r(87357),u=r(15861),d=r(10945),h=r(87109),x=r(83321),f=r(42761),p=r(39264),j=r(11163),g=r(67294),m=r(49925),Z=r(34300),y=r(50838),w=r(23279),C=r.n(w),S=r(726);function _(){let e=(0,a.Z)({palette:{primary:{main:"#018294"},success:{main:"#A9C470"},error:{main:"#FE616A"}}}),{user:t}=(0,y.Eu)(),[r,w]=(0,g.useState)([]),[_,J]=(0,g.useState)(""),b=(0,j.useRouter)();(0,g.useEffect)(()=>{k()},[]);let v=C()(async e=>{try{let t=await (0,S.Z)("products","name",e),r=t.filter(e=>!e.delete);w(r)}catch(e){console.error("Error searching data:",e)}},500),E=e=>{J(e),v(e)},k=async()=>{let{result:e,error:t}=await (0,m._N)("products");if(t)console.error("Error fetching document:",t);else if(e){let t=e.docs.filter(e=>!e.data().delete).map(e=>({id:e.id,...e.data()}));w(t)}},P=async e=>{let r={id:e,user_id:t.uid},l=await (0,Z.RS)("products",r);E(""),l?(L((0,n.jsx)(o.Z,{severity:"success",onClose:R,children:"ลบข้อมูลสำเร็จ"})),U(!0)):(L((0,n.jsx)(o.Z,{severity:"error",onClose:R,children:"ผิดพลาด! ไม่สามารถลบข้อมูลได้"})),U(!0))},[z,L]=(0,g.useState)(null),[N,U]=(0,g.useState)(!1),R=(e,t)=>{"clickaway"!==t&&U(!1)};return(0,n.jsxs)(l.Z,{children:[(0,n.jsx)(s.Z,{open:N,autoHideDuration:6e3,onClose:R,children:z}),(0,n.jsx)(c.Z,{theme:e,children:(0,n.jsxs)(i.Z,{sx:{height:"100%",width:"100%",mt:5},children:[(0,n.jsx)(u.Z,{sx:{fontSize:"2rem",fontWeight:"600"},children:"การจัดการสินค้า"}),(0,n.jsx)(i.Z,{sx:{mt:1},children:(0,n.jsx)(d.Z,{label:"ค้นหา",variant:"outlined",size:"small",onChange:e=>E(e.target.value),InputProps:{startAdornment:(0,n.jsx)(h.Z,{position:"start",children:(0,n.jsx)(f.Z,{sx:{fontSize:"1.4rem"}})})}})}),(0,n.jsxs)(i.Z,{children:[(0,n.jsxs)(i.Z,{sx:{display:"flex",justifyContent:{xl:"flex-end"}},children:[(0,n.jsx)(x.Z,{variant:"contained",color:"success",sx:{mr:2,mb:2,mt:2},onClick:function(){b.push("/product/addproduct")},children:"เพิ่มสินค้า"}),(0,n.jsx)(x.Z,{variant:"contained",color:"error",sx:{mb:2,mt:2},onClick:()=>{b.push("product/history")},children:"ประวัติการลบ"})]}),(0,n.jsx)(p.default,{data:{data:r},onDelete:P})]})]})})]})}},39264:function(e,t,r){r.r(t),r.d(t,{default:function(){return J}});var n=r(85893),l=r(67294),a=r(90948),o=r(7906),s=r(295),c=r(98102),i=r(89755),u=r(72882),d=r(53184),h=r(53816),x=r(90629),f=r(50657),p=r(37645),j=r(31425),g=r(83321),m=r(87357),Z=r(93946),y=r(77957),w=r(25675),C=r.n(w),S=r(11163),_=r(41733);function J(e){let{data:t,onDelete:r}=e,w=(0,S.useRouter)(),J=e=>{w.push({pathname:"/product/editproduct",query:{product_id:JSON.stringify(e)}})},b=(0,a.ZP)(c.Z)(e=>{let{theme:t}=e;return{["&.".concat(i.Z.head)]:{backgroundColor:"#018294",color:t.palette.common.white},["&.".concat(i.Z.body)]:{fontSize:14}}}),v=(0,a.ZP)(h.Z)(e=>{let{theme:t}=e;return{"&:nth-of-type(odd)":{backgroundColor:t.palette.action.hover},"&:last-child td, &:last-child th":{border:0}}}),[E,k]=l.useState([]);l.useEffect(()=>{t&&t.data&&k(t.data),console.log("doc มา table: ",t)},[t]);let P=E.map((e,t)=>{var r,n,l;return r=e.id,n=e.img,l=e.name,{No:t+1,id:r,img:n,p_name:l,p_sell:null,p_left:e.productSizes[0].quantity,p_price:e.productSizes[0].price.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","),status:!0===e.status?"พร้อมขาย":"ไม่พร้อมขาย"}}),[z,L]=l.useState(!1),[N,U]=l.useState(null),R=e=>{L(!0),U(e)},B=()=>{L(!1)};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(f.Z,{open:z,onClose:B,children:[(0,n.jsx)(p.Z,{children:"ยืนยันที่จะลบหรือไม่?"}),(0,n.jsxs)(j.Z,{children:[(0,n.jsx)(g.Z,{onClick:B,children:"ยกเลิก"}),(0,n.jsx)(g.Z,{onClick:()=>{r(N),L(!1)},autoFocus:!0,children:"ยืนยัน"})]})]}),(0,n.jsx)(u.Z,{component:x.Z,sx:{borderRadius:"25px"},children:(0,n.jsxs)(o.Z,{sx:{minWidth:700},children:[(0,n.jsx)(d.Z,{children:(0,n.jsxs)(h.Z,{children:[(0,n.jsx)(b,{children:"No."}),(0,n.jsx)(b,{align:"center",children:"รูปภาพ"}),(0,n.jsx)(b,{children:"ชื่อสินค้า"}),(0,n.jsx)(b,{children:"ขาย"}),(0,n.jsx)(b,{children:"เหลือ"}),(0,n.jsx)(b,{children:"ราคา"}),(0,n.jsx)(b,{align:"center",children:"สถานะสินค้า"}),(0,n.jsx)(b,{align:"center",children:"แก้ไข"}),(0,n.jsx)(b,{}),(0,n.jsx)(b,{align:"center",children:"ลบ"})]})}),(0,n.jsx)(s.Z,{children:P.map(e=>(0,n.jsxs)(v,{children:[(0,n.jsx)(b,{component:"th",scope:"row",children:e.No}),(0,n.jsx)(b,{children:(0,n.jsx)(C(),{src:e.img,alt:"Product Image",priority:!0,height:"75",width:"75"})}),(0,n.jsx)(b,{children:e.p_name}),(0,n.jsx)(b,{children:e.p_sell}),(0,n.jsx)(b,{children:e.p_left}),(0,n.jsx)(b,{children:e.p_price}),(0,n.jsx)(b,{align:"center",children:(0,n.jsx)(m.Z,{sx:{backgroundColor:"พร้อมขาย"===e.status?"rgba(169, 196, 112, 0.61)":"rgba(254, 97, 106, 0.50)",p:1,borderRadius:"10px"},children:e.status})}),(0,n.jsx)(b,{align:"center",children:(0,n.jsx)(Z.Z,{color:"primary",onClick:()=>J(e.id),children:(0,n.jsx)(y.Z,{})})}),(0,n.jsx)(b,{align:"center",children:(0,n.jsx)(g.Z,{variant:"contained",size:"small",children:"ปรับสต็อก"})}),(0,n.jsx)(b,{align:"center",children:(0,n.jsx)(Z.Z,{color:"primary",onClick:()=>R(e.id),children:(0,n.jsx)(_.Z,{})})})]},e.No))})]})})]})}}}]);