(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2867],{61920:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/product/history",function(){return r(25556)}])},34300:function(e,t,r){"use strict";r.d(t,{RS:function(){return a},SR:function(){return s},ZP:function(){return c},cB:function(){return d}});var l=r(11802),n=r(36100),o=r(49925);let i=(0,n.ad)(l.Z);async function c(e,t){let r=null,l=null,o=(0,n.JU)(i,"catalog",t.catalog_id);try{let l=t.img?t.img:"",c={name:t.name,catalog_id:o,detail:t.detail,flim:t.flim,grade:t.grade,lot:t.lot,status:t.status,img:l,area:t.area,productSizes:t.productSizes,delete:null,create:{createAt:(0,n.Bt)(),createBy:t.user_id},update:null};r=await (0,n.ET)((0,n.hJ)(i,e),c),console.log("เพิ่มข้อมูลสำเร็จ",r)}catch(e){console.error("เกิดข้อผิดพลาดในการเพิ่มข้อมูล:",l=e)}return{result:r,error:l}}let s=async(e,t)=>{let r=null,l=null,o=(0,n.JU)(i,e,t);try{await (0,n.oe)(o),console.log("ลบข้อมูลสำเร็จ"),r="Success"}catch(e){console.error("เกิดข้อผิดพลาดในการลบข้อมูล:",l=e)}return{result:r,error:l}};async function a(e,t){let r=null,l=null;try{let l=await (0,o.ZP)("users",t.user_id);if(l.result&&l.result.exists){let o=l.result.data().name,c={delete:{deleteAt:(0,n.Bt)(),deleteBy:o}};r=await (0,n.pl)((0,n.JU)(i,e,t.id),c,{merge:!0}),console.log("Soft delete สำเร็จ",r)}else console.log("หาข้อมูล user ใน soft del ไม่เจอ")}catch(e){console.error("เกิดข้อผิดพลาดในการ soft delete:",l=e)}return{result:r,error:l}}async function d(e,t){let r=null,l=null;try{r=await (0,n.pl)((0,n.JU)(i,e,t),{delete:null},{merge:!0}),console.log("restoreData สำเร็จ",r)}catch(e){console.error("เกิดข้อผิดพลาดในการ restoreData:",l=e)}return{result:r,error:l}}},25556:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return B}});var l=r(85893),n=r(9913),o=r(7906),i=r(295),c=r(98102),s=r(89755),a=r(72882),d=r(53184),u=r(53816),h=r(90629),x=r(25675),m=r.n(x),g=r(90948),p=r(68239),f=r(22430),j=r(67294),y=r(49925),Z=r(46901),w=r(58703),_=r(87357),S=r(15861),b=r(83321),C=r(96471),k=r(34300);function B(){let e=(0,g.ZP)(c.Z)(e=>{let{theme:t}=e;return{["&.".concat(s.Z.head)]:{backgroundColor:"#018294",color:t.palette.common.white},["&.".concat(s.Z.body)]:{fontSize:14}}}),t=(0,g.ZP)(u.Z)(e=>{let{theme:t}=e;return{"&:nth-of-type(odd)":{backgroundColor:t.palette.action.hover},"&:last-child td, &:last-child th":{border:0}}}),r=(0,p.Z)({palette:{primary:{main:"#018294"},success:{main:"#A9C470"},error:{main:"#FE616A"}}}),[x,B]=(0,j.useState)([]);(0,j.useEffect)(()=>{A()},[]);let A=async()=>{let{result:e,error:t}=await (0,y._N)("products");if(t)console.error("Error fetching document:",t);else if(e){let t=e.docs.filter(e=>e.data().delete).map(e=>({id:e.id,name:e.data().name,productSizes:e.data().productSizes,img:e.data().img,deleteAt:e.data().delete.deleteAt,deleteBy:e.data().delete.deleteBy}));B(t)}},N=async e=>{let t=await (0,k.cB)("products",e);A(),t?(P((0,l.jsx)(Z.Z,{severity:"success",onClose:R,children:"กู้คืนข้อมูลสำเร็จ"})),J(!0)):(P((0,l.jsx)(Z.Z,{severity:"error",onClose:R,children:"ผิดพลาด! ไม่สามารถกู้คืนข้อมูลได้"})),J(!0))},E=async e=>{let t=await (0,k.SR)("products",e);A(),t?(P((0,l.jsx)(Z.Z,{severity:"success",onClose:R,children:"ลบข้อมูลถาวรสำเร็จ"})),J(!0)):(P((0,l.jsx)(Z.Z,{severity:"error",onClose:R,children:"ผิดพลาด! ไม่สามารถลบข้อมูลถาวรได้"})),J(!0))},[v,P]=(0,j.useState)(null),[z,J]=(0,j.useState)(!1),R=(e,t)=>{"clickaway"!==t&&J(!1)},D=x.map((e,t)=>{var r;let l=e.deleteAt?e.deleteAt.toDate().toLocaleString("th-TH",{dateStyle:"full",timeStyle:"medium"}):"";return r=e.id,{No:t+1,id:r,img:e.img,p_name:e.name,deleteAt:l,deleteBy:e.deleteBy}});return(0,l.jsxs)(n.Z,{children:[(0,l.jsx)(w.Z,{open:z,autoHideDuration:6e3,onClose:R,children:v}),(0,l.jsx)(f.Z,{theme:r,children:(0,l.jsx)(_.Z,{children:(0,l.jsxs)(_.Z,{sx:{height:"100%",width:"100%",mt:5},children:[(0,l.jsx)(S.Z,{sx:{fontSize:"2rem",fontWeight:"600"},children:"ประวัติการลบสินค้า"}),(0,l.jsxs)(b.Z,{sx:{color:"#018294",bgcolor:"white",fontWeight:"bold",borderRadius:"50px",boxShadow:"4px 4px 4px 0px rgba(0, 0, 0, 0.25)",mb:2},onClick:()=>{window.history.back()},children:[(0,l.jsx)(C.Z,{}),(0,l.jsx)(S.Z,{children:" ย้อนกลับ"})]}),(0,l.jsx)(a.Z,{component:h.Z,sx:{borderRadius:"25px"},children:(0,l.jsxs)(o.Z,{sx:{minWidth:700},children:[(0,l.jsx)(d.Z,{children:(0,l.jsxs)(u.Z,{children:[(0,l.jsx)(e,{align:"center",children:"No."}),(0,l.jsx)(e,{align:"center",children:"รูปภาพ"}),(0,l.jsx)(e,{children:"ชื่อสินค้า"}),(0,l.jsx)(e,{children:"วันที่ลบ"}),(0,l.jsx)(e,{children:"ผู้ลบ"}),(0,l.jsx)(e,{align:"center"}),(0,l.jsx)(e,{align:"center"})]})}),(0,l.jsx)(i.Z,{children:D.map(r=>(0,l.jsxs)(t,{children:[(0,l.jsx)(e,{component:"th",scope:"row",align:"center",children:r.No}),(0,l.jsx)(e,{align:"center",children:(0,l.jsx)(m(),{src:r.img,alt:"Product Image",priority:!0,height:"75",width:"75"})}),(0,l.jsx)(e,{children:r.p_name}),(0,l.jsx)(e,{children:r.deleteAt}),(0,l.jsx)(e,{children:r.deleteBy}),(0,l.jsx)(e,{align:"center",children:(0,l.jsx)(b.Z,{color:"primary",onClick:()=>N(r.id),children:"กู้คืน"})}),(0,l.jsx)(e,{align:"center",children:(0,l.jsx)(b.Z,{color:"primary",onClick:()=>E(r.id),children:"ลบถาวร"})})]},r.No))})]})})]})})})]})}}},function(e){e.O(0,[2607,7609,5675,6185,1283,3717,3914,4792,9254,5149,9913,9774,2888,179],function(){return e(e.s=61920)}),_N_E=e.O()}]);